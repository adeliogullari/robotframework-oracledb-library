*** Settings ***
Library  OracleDBLibrary

*** Variables ***
${HOST} =  localhost
${PORT} =  1521
${SID} =  ORCLCDB
${SERVICE NAME} =  ORCLPDB1.localdomain
${USER} =  SYS
${PASSWORD} =  Oradoc_db1
${MODE} =  SYSDBA

${WRONG USER ERROR} =  DatabaseError: ORA-01017: invalid username/password; logon denied
${WRONG PASSWORD ERROR} =  DatabaseError: ORA-01017: invalid username/password; logon denied
${WRONG DSN ERROR} =  DatabaseError: ORA-12154: TNS:could not resolve the connect identifier specified
${WRONG MODE ERROR} =  DatabaseError: ORA-01031: insufficient privileges
${INVALID DATA ERROR} =  DatabaseError: ORA-00947: not enough values

${ILLEGAL VARIABLE} =  DatabaseError: ORA-01036: illegal variable name/number
${SCROLL OUT OF RANGE} =  DatabaseError: DPI-1027: scroll operation would go out of the result set

${BATCH SIZE} =  ${2}
${SCROLL SIZE} =  ${3}

*** Test Cases ***
CONNECT TO ORACLE DATABASE WITH SID SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ${CONNECTION STATUS} =  ORACLE CONNECTION PING
    SHOULD BE EQUAL  ${CONNECTION STATUS}  ${NONE}
    ORACLE CONNECTION CLOSE

CONNECT TO ORACLE DATABASE WITH SERVICE NAME SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  service_name=${SERVICE NAME}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ${CONNECTION STATUS} =  ORACLE CONNECTION PING
    SHOULD BE EQUAL  ${CONNECTION STATUS}  ${NONE}
    ORACLE CONNECTION CLOSE

CONNECT TO ORACLE DATABASE WITH WRONG USER FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    RUN KEYWORD AND EXPECT ERROR  ${WRONG USER ERROR}  ORACLE CONNECT  user=WRONG_USER  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}

CONNECT TO ORACLE DATABASE WITH WRONG PASSWORD FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    RUN KEYWORD AND EXPECT ERROR  ${WRONG PASSWORD ERROR}  ORACLE CONNECT  user=${USER}  password=WRONG_PASSWORD  dsn=${DSN}  mode=${MODE}

CONNECT TO ORACLE DATABASE WITH WRONG DSN FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    RUN KEYWORD AND EXPECT ERROR  ${WRONG DSN ERROR}  ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=WRONG_DSN  mode=${MODE}

CONNECT TO ORACLE DATABASE WITH WRONG MODE FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    RUN KEYWORD AND EXPECT ERROR  ${WRONG MODE ERROR}  ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=SYSRAC

CREATE ORACLE CONNECTION CURSOR SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

INSERT DATA INTO ORACLE DATABASE SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Ahmet', 'Yalcinkaya')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Abdullah', 'Deliogullari')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons (person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

INSERT INVALID DATA INTO ORACLE DATABASE FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  SET VARIABLE  INVALID_QUERY
    ORACLE CURSOR EXECUTE  CREATE TABLE persons (person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    RUN KEYWORD AND EXPECT ERROR  ${INVALID DATA ERROR}   ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

FETCH DATA FROM ORACLE DATABASE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Ahmet', 'Yalcinkaya')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Abdullah', 'Deliogullari')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHALL ROWS} =  ORACLE CURSOR FETCHALL
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${FIRST TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${SECOND TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHMANY ROWS} =  ORACLE CURSOR FETCHMANY  ${BATCH SIZE}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

SCROLL CURSOR AND FETCH DATA FROM ORACLE DATABASE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Ahmet', 'Yalcinkaya')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Abdullah', 'Deliogullari')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CONNECTION CURSOR  scrollable=${True}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ORACLE CURSOR SCROLL  ${SCROLL SIZE}  mode=absolute
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

SCROLL CURSOR AND FETCH DATA FROM ORACLE DATABASE FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Ahmet', 'Yalcinkaya')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Abdullah', 'Deliogullari')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CONNECTION CURSOR  scrollable=${True}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    RUN KEYWORD AND EXPECT ERROR  ${SCROLL OUT OF RANGE}  ORACLE CURSOR SCROLL  ${8}  mode=absolute
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

FETCH DATA FROM ORACLE DATABASE WITH AUTOCOMMIT
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CONNECTION AUTOCOMMIT  ${True}
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Ahmet', 'Yalcinkaya')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Abdullah', 'Deliogullari')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHALL ROWS} =  ORACLE CURSOR FETCHALL
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${FIRST TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${SECOND TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHMANY ROWS} =  ORACLE CURSOR FETCHMANY  ${BATCH SIZE}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION AUTOCOMMIT  ${False}
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

PREPARE AND EXECUTE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR PREPARE  INSERT INTO persons(person_id, first_name, last_name) VALUES(1432, :name, 'Yalcinkaya')
    ORACLE CURSOR EXECUTE  ${NONE}  name=Abdullah
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${ROWS} =  ORACLE CURSOR FETCHALL
    ${ROW} =  ORACLE CURSOR FETCHONE
    ${ROWSS} =  ORACLE CURSOR FETCHMANY  ${BATCH SIZE}
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

ORACLE CALL FUNCTION
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  create or replace function myfunc (a_StrVal varchar2, a_NumVal number) return number as begin return length(a_StrVal) + a_NumVal * 2; end;
    ${RETURN VAL} =  ORACLE CURSOR CALLFUNC  myfunc  ${{int}}  ${{["a string", 15]}}
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE
