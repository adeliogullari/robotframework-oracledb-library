*** Settings ***
Library  String
Library  OracleDBLibrary

*** Variables ***
${HOST} =  localhost
${PORT} =  1521
${SID} =  ORCLCDB
${USER} =  SYS
${PASSWORD} =  Oracle_123
${MODE} =  SYSDBA

${INVALID DATA ERROR} =  DatabaseError: ORA-00947: not enough values
${SCROLL RANGE ERROR} =  DatabaseError: DPI-1027: scroll operation would go out of the result set

${BATCH SIZE} =  ${2}
${SCROLL SIZE} =  ${3}

*** Test Cases ***
CREATE ORACLE CONNECTION CURSOR SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

INSERT DATA INTO ORACLE DATABASE SUCCESSFULLY
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${PRIMARY KEY} =  Generate Random String  4  [NUMBERS]
    ${FIRST NAME} =  Generate Random String  8  [LETTERS]
    ${LAST NAME} =  Generate Random String  8  [LETTERS]
    ${FIRST TABLE ROW} =  EVALUATE  ("${PRIMARY KEY}", "${FIRST NAME}", "${LAST NAME}")
    ORACLE CURSOR EXECUTE  CREATE TABLE persons (person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

INSERT INVALID DATA INTO ORACLE DATABASE FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  SET VARIABLE  INVALID_QUERY
    ORACLE CURSOR EXECUTE  CREATE TABLE persons (person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    RUN KEYWORD AND EXPECT ERROR  STARTS:${INVALID DATA ERROR}   ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

FETCH DATA FROM ORACLE DATABASE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Abdullah', 'Deliogullari')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Ahmet Burhan', 'Kutuk')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHALL ROWS} =  ORACLE CURSOR FETCHALL
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${FIRST TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${SECOND TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHMANY ROWS} =  ORACLE CURSOR FETCHMANY  ${BATCH SIZE}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

SCROLL CURSOR AND FETCH DATA FROM ORACLE DATABASE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Abdullah', 'Deliogullari')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Ahmet Burhan', 'Kutuk')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CONNECTION CURSOR  scrollable=${True}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ORACLE CURSOR SCROLL  ${SCROLL SIZE}  mode=absolute
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

SCROLL CURSOR AND FETCH DATA FROM ORACLE DATABASE FAILURE
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Abdullah', 'Deliogullari')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Ahmet Burhan', 'Kutuk')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons(person_id, first_name, last_name) VALUES${THIRD TABLE ROW}
    ORACLE CONNECTION COMMIT
    ORACLE CONNECTION CURSOR  scrollable=${True}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    RUN KEYWORD AND EXPECT ERROR  ${SCROLL RANGE ERROR}  ORACLE CURSOR SCROLL  ${8}  mode=absolute
    ORACLE CONNECTION CURSOR
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION COMMIT
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE

FETCH DATA FROM ORACLE DATABASE WITH AUTOCOMMIT
    ${DSN} =  ORACLE MAKEDSN  host=${HOST}  port=${PORT}  sid=${SID}
    ORACLE CONNECT  user=${USER}  password=${PASSWORD}  dsn=${DSN}  mode=${MODE}
    ORACLE CONNECTION CURSOR
    ORACLE CONNECTION AUTOCOMMIT  ${True}
    ${FIRST TABLE ROW} =  EVALUATE  (1432, 'Abdullah', 'Deliogullari')
    ${SECOND TABLE ROW} =  EVALUATE  (1453, 'Ahmet Burhan', 'Kutuk')
    ${THIRD TABLE ROW} =  EVALUATE  (1481, 'Erim', 'Cerrahoglu')
    ORACLE CURSOR EXECUTE  CREATE TABLE persons(person_id NUMBER GENERATED BY DEFAULT AS IDENTITY, first_name VARCHAR2(50) NOT NULL, last_name VARCHAR2(50) NOT NULL, PRIMARY KEY(person_id))
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${FIRST TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  INSERT INTO persons (person_id, first_name, last_name) VALUES ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHALL ROWS} =  ORACLE CURSOR FETCHALL
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${FIRST TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${SECOND TABLE ROW}
    ${FETCHONE ROW} =  ORACLE CURSOR FETCHONE
    SHOULD BE EQUAL  ${FETCHONE ROW}  ${THIRD TABLE ROW}
    ORACLE CURSOR EXECUTE  SELECT person_id, first_name, last_name FROM persons
    ${FETCHMANY ROWS} =  ORACLE CURSOR FETCHMANY  ${BATCH SIZE}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${FIRST TABLE ROW}
    SHOULD CONTAIN  ${FETCHALL ROWS}  ${SECOND TABLE ROW}
    ORACLE CURSOR EXECUTE  DROP TABLE persons
    ORACLE CONNECTION AUTOCOMMIT  ${False}
    ORACLE CURSOR CLOSE
    ORACLE CONNECTION CLOSE